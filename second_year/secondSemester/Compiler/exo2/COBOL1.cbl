IDENTIFICATION DIVISION.
PROGRAM-ID. STUDENT-FINANCIAL-REPORT.

DATA DIVISION.
WORKING-STORAGE SECTION.

01 WS-FEES-TABLE.
   05 WS-FEE-ENTRY OCCURS 3 TIMES INDEXED BY FEE-IDX.
      10 WS-FEE-TYPE        PIC X(1).
      10 WS-FEE-AMT         PIC 9(5)V99.

01 WS-STUDENT-TABLE.
   05 WS-STUDENT-ENTRY OCCURS 18 TIMES INDEXED BY STUDENT-IDX.
      10 WS-STUDENT-ID      PIC X(9).
      10 WS-STUDENT-NAME    PIC X(10).
      10 WS-STUDENT-TYPE    PIC X(1).
      10 WS-STUDENT-FEE     PIC 9(5)V99 VALUE 0.
      10 WS-STUDENT-PAID    PIC 9(5)V99 VALUE 0.
      10 WS-STUDENT-SHORTAGE PIC 9(5)V99 VALUE 0.

01 WS-TOTAL-PAID            PIC 9(7)V99 VALUE 0.

01 WS-DISPLAY-LINE.
   05 DL-STUDENT-ID         PIC X(9).
   05 FILLER                PIC X(2) VALUE SPACES.
   05 DL-NAME               PIC X(10).
   05 FILLER                PIC X(2) VALUE SPACES.
   05 DL-FEE                PIC ZZ,ZZ9.99.
   05 FILLER                PIC X(2) VALUE SPACES.
   05 DL-PAID               PIC ZZ,ZZ9.99.
   05 FILLER                PIC X(2) VALUE SPACES.
   05 DL-SHORTAGE           PIC ZZ,ZZ9.99.

01 WS-HEADER.
   05 FILLER PIC X(11) VALUE "Student.ID ".
   05 FILLER PIC X(12) VALUE "Name       ".
   05 FILLER PIC X(14) VALUE "Fee_Require  ".
   05 FILLER PIC X(14) VALUE "Amount_Paid  ".
   05 FILLER PIC X(11) VALUE "Shortage".

01 WS-TOTAL-DISPLAY.
   05 FILLER                PIC X(23) VALUE "Total Payment Received:".
   05 WS-FMT-TOTAL          PIC Z,ZZZ,ZZ9.99.

PROCEDURE DIVISION.
000-MAIN.
   PERFORM 100-INITIALIZE-DATA
   PERFORM 200-CALCULATE-FEES
   PERFORM 300-CALCULATE-STATUS
   PERFORM 400-DISPLAY-REPORT
   STOP RUN.

100-INITIALIZE-DATA.
   *> Initialize fee structure
   MOVE 'A' TO WS-FEE-TYPE(1)
   MOVE 0.00 TO WS-FEE-AMT(1)
   MOVE 'B' TO WS-FEE-TYPE(2)
   MOVE 21345.00 TO WS-FEE-AMT(2)
   MOVE 'C' TO WS-FEE-TYPE(3)
   MOVE 42690.00 TO WS-FEE-AMT(3)

   *> Initialize student data
   MOVE '920121001' TO WS-STUDENT-ID(1)
   MOVE 'Andy     ' TO WS-STUDENT-NAME(1)
   MOVE 'A' TO WS-STUDENT-TYPE(1)

   MOVE '920121002' TO WS-STUDENT-ID(2)
   MOVE 'Bob      ' TO WS-STUDENT-NAME(2)
   MOVE 'B' TO WS-STUDENT-TYPE(2)
   MOVE 21345.00 TO WS-STUDENT-PAID(2)

   MOVE '920121003' TO WS-STUDENT-ID(3)
   MOVE 'Cecil    ' TO WS-STUDENT-NAME(3)
   MOVE 'C' TO WS-STUDENT-TYPE(3)
   MOVE 42690.00 TO WS-STUDENT-PAID(3)

   MOVE '920121004' TO WS-STUDENT-ID(4)
   MOVE 'Dennis   ' TO WS-STUDENT-NAME(4)
   MOVE 'A' TO WS-STUDENT-TYPE(4)

   MOVE '920121005' TO WS-STUDENT-ID(5)
   MOVE 'Edward   ' TO WS-STUDENT-NAME(5)
   MOVE 'B' TO WS-STUDENT-TYPE(5)
   MOVE 21345.00 TO WS-STUDENT-PAID(5)

   MOVE '920121006' TO WS-STUDENT-ID(6)
   MOVE 'Felix    ' TO WS-STUDENT-NAME(6)
   MOVE 'C' TO WS-STUDENT-TYPE(6)
   MOVE 42690.00 TO WS-STUDENT-PAID(6)

   MOVE '920121007' TO WS-STUDENT-ID(7)
   MOVE 'Gigi     ' TO WS-STUDENT-NAME(7)
   MOVE 'B' TO WS-STUDENT-TYPE(7)

   MOVE '920121008' TO WS-STUDENT-ID(8)
   MOVE 'Helen    ' TO WS-STUDENT-NAME(8)
   MOVE 'B' TO WS-STUDENT-TYPE(8)
   MOVE 10000.00 TO WS-STUDENT-PAID(8)

   MOVE '920121009' TO WS-STUDENT-ID(9)
   MOVE 'Iris     ' TO WS-STUDENT-NAME(9)
   MOVE 'B' TO WS-STUDENT-TYPE(9)
   MOVE 21345.00 TO WS-STUDENT-PAID(9)

   MOVE '920121010' TO WS-STUDENT-ID(10)
   MOVE 'Jane     ' TO WS-STUDENT-NAME(10)
   MOVE 'A' TO WS-STUDENT-TYPE(10)

   MOVE '920121011' TO WS-STUDENT-ID(11)
   MOVE 'Kate     ' TO WS-STUDENT-NAME(11)
   MOVE 'B' TO WS-STUDENT-TYPE(11)
   MOVE 20000.00 TO WS-STUDENT-PAID(11)

   MOVE '920121012' TO WS-STUDENT-ID(12)
   MOVE 'Liz      ' TO WS-STUDENT-NAME(12)
   MOVE 'C' TO WS-STUDENT-TYPE(12)
   MOVE 21345.00 TO WS-STUDENT-PAID(12)

   MOVE '920121013' TO WS-STUDENT-ID(13)
   MOVE 'Martin   ' TO WS-STUDENT-NAME(13)
   MOVE 'A' TO WS-STUDENT-TYPE(13)

   MOVE '920121014' TO WS-STUDENT-ID(14)
   MOVE 'Nancy    ' TO WS-STUDENT-NAME(14)
   MOVE 'B' TO WS-STUDENT-TYPE(14)
   MOVE 15000.00 TO WS-STUDENT-PAID(14)

   MOVE '920121015' TO WS-STUDENT-ID(15)
   MOVE 'Oscar    ' TO WS-STUDENT-NAME(15)
   MOVE 'C' TO WS-STUDENT-TYPE(15)
   MOVE 21345.00 TO WS-STUDENT-PAID(15)

   MOVE '920121016' TO WS-STUDENT-ID(16)
   MOVE 'Pattie   ' TO WS-STUDENT-NAME(16)
   MOVE 'B' TO WS-STUDENT-TYPE(16)

   MOVE '920121017' TO WS-STUDENT-ID(17)
   MOVE 'Quinn    ' TO WS-STUDENT-NAME(17)
   MOVE 'B' TO WS-STUDENT-TYPE(17)
   MOVE 21345.00 TO WS-STUDENT-PAID(17)

   MOVE '920121018' TO WS-STUDENT-ID(18)
   MOVE 'Rebecca  ' TO WS-STUDENT-NAME(18)
   MOVE 'B' TO WS-STUDENT-TYPE(18)
   MOVE 21345.00 TO WS-STUDENT-PAID(18).

200-CALCULATE-FEES.
   PERFORM VARYING STUDENT-IDX FROM 1 BY 1 UNTIL STUDENT-IDX > 18
      PERFORM VARYING FEE-IDX FROM 1 BY 1 UNTIL FEE-IDX > 3
         IF WS-STUDENT-TYPE(STUDENT-IDX) = WS-FEE-TYPE(FEE-IDX)
            MOVE WS-FEE-AMT(FEE-IDX) TO WS-STUDENT-FEE(STUDENT-IDX)
         END-IF
      END-PERFORM
   END-PERFORM.

300-CALCULATE-STATUS.
   PERFORM VARYING STUDENT-IDX FROM 1 BY 1 UNTIL STUDENT-IDX > 18
      COMPUTE WS-STUDENT-SHORTAGE(STUDENT-IDX) =
              WS-STUDENT-FEE(STUDENT-IDX) - WS-STUDENT-PAID(STUDENT-IDX)
      ADD WS-STUDENT-PAID(STUDENT-IDX) TO WS-TOTAL-PAID
   END-PERFORM.

400-DISPLAY-REPORT.
   MOVE WS-TOTAL-PAID TO WS-FMT-TOTAL
   DISPLAY WS-TOTAL-DISPLAY
   DISPLAY " "
   DISPLAY "Students with Shortage:"
   DISPLAY WS-HEADER
   PERFORM VARYING STUDENT-IDX FROM 1 BY 1 UNTIL STUDENT-IDX > 18
      IF WS-STUDENT-SHORTAGE(STUDENT-IDX) > 0
         MOVE WS-STUDENT-ID(STUDENT-IDX) TO DL-STUDENT-ID
         MOVE WS-STUDENT-NAME(STUDENT-IDX) TO DL-NAME
         MOVE WS-STUDENT-FEE(STUDENT-IDX) TO DL-FEE
         MOVE WS-STUDENT-PAID(STUDENT-IDX) TO DL-PAID
         MOVE WS-STUDENT-SHORTAGE(STUDENT-IDX) TO DL-SHORTAGE
         DISPLAY WS-DISPLAY-LINE
      END-IF
   END-PERFORM.
